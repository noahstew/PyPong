# Pygame setup
import pygame
from pygame.locals import *

pygame.init()
pygame.font.init()

# Window setup
WINDOW_WIDTH = 1000
WINDOW_HEIGHT = 600
WINDOW_DIM = (WINDOW_WIDTH, WINDOW_HEIGHT)
DISPLAY = pygame.display.set_mode(WINDOW_DIM)
pygame.display.set_caption("PyPong")
FPS = 60

# Colors
BLACK = (0, 0, 0)
WHITE = (255, 255, 255)
GRAY = (128, 128, 128)

RED = (255, 0, 0)
ORANGE = (255, 128, 0)
YELLOW = (255, 255, 0)
GREEN = (0, 255, 0)
LIGHT_BLUE = (0, 255, 255)
ROYAL_BLUE = (0, 128, 255)
BLUE = (0, 0, 255)
PURPLE = (128, 0, 255)
PINK = (255, 0, 255)
MAGENTA = (255, 0, 128)

# Custom Colors
TENNIS_BALL = (210, 255, 28)
NET = (192, 192, 192)
COURT = (104, 204, 0)
SCOREBOARD = (76, 153, 0)
PLAYER_ONE = (204, 0, 0)
PLAYER_TWO = (0, 51, 102)

# TODO: Add game element variables
# Paddle
PADDLE_INSET = 10  # how far in from edge of window the paddle will be
PADDLE_WIDTH = 20
PADDLE_HEIGHT = 60
PADDLE_SPEED = 5

# Ball
BALL_SIZE = 10
BALL_SPEED_X = -7
BALL_SPEED_Y = 0

# Scoreboard
left_score = 0
right_score = 0
scoreboard_font_size = 400
scoreboard_font = pygame.font.SysFont("Arial", scoreboard_font_size)
# End of solution

# Clock setup
clock = pygame.time.Clock()

# Running loop begins
running = True

# TODO: Set initial position of paddles and ball
# Note: Run with without second operation, see problem, fix the problem (Explain why problem occurs w/ drawing)
left_paddle_y = (WINDOW_HEIGHT / 2) - (PADDLE_HEIGHT / 2)
right_paddle_y = (WINDOW_HEIGHT / 2) - (PADDLE_HEIGHT / 2)

ball_x_start = (WINDOW_WIDTH / 2)
ball_y_start = (WINDOW_HEIGHT / 2) - (BALL_SIZE / 2)
ball_x = ball_x_start
ball_y = ball_y_start

while running:

    left_paddle_rect = pygame.Rect(PADDLE_INSET, left_paddle_y, PADDLE_WIDTH, PADDLE_HEIGHT)
    right_paddle_rect = pygame.Rect(WINDOW_WIDTH - PADDLE_INSET - PADDLE_WIDTH, right_paddle_y, PADDLE_WIDTH,
                                    PADDLE_HEIGHT)
# End of solution

    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            running = False

    # Display Court Color
    DISPLAY.fill(COURT)

    # TODO: Check if button in home screen is clicked

    # End of solution
    # TODO: Give objects movement
    keys_pressed = pygame.key.get_pressed()
    if keys_pressed[pygame.K_w] and left_paddle_y > 0:
        left_paddle_y -= PADDLE_SPEED
    if keys_pressed[pygame.K_s] and left_paddle_y < WINDOW_HEIGHT - PADDLE_HEIGHT:
        left_paddle_y += PADDLE_SPEED
    if keys_pressed[pygame.K_UP] and right_paddle_y > 0:
        right_paddle_y -= PADDLE_SPEED
    if keys_pressed[pygame.K_DOWN] and right_paddle_y < WINDOW_HEIGHT - PADDLE_HEIGHT:
        right_paddle_y += PADDLE_SPEED

    ball_x += BALL_SPEED_X
    ball_y += BALL_SPEED_Y
    # End of solution

    # TODO: Setup collisions !!CURRENTLY WORKING ON PADDLE PHYSICS
    # Paddle physics
    if PADDLE_WIDTH + PADDLE_INSET >= ball_x > PADDLE_INSET:
        if left_paddle_y < ball_y < left_paddle_y + PADDLE_HEIGHT:
            BALL_SPEED_X = abs(BALL_SPEED_X)
    if WINDOW_WIDTH - PADDLE_INSET - PADDLE_WIDTH <= ball_x < WINDOW_WIDTH - PADDLE_INSET:
        if right_paddle_y < ball_y < right_paddle_y + PADDLE_HEIGHT:
            BALL_SPEED_X = -abs(BALL_SPEED_X)

    # Ball physics
    if ball_y < BALL_SIZE:
        BALL_SPEED_Y = abs(BALL_SPEED_Y)
    elif ball_y > WINDOW_HEIGHT - BALL_SIZE:
        BALL_SPEED_Y = -abs(BALL_SPEED_Y)
    if ball_x < 0:
        right_score += 1
        ball_x = ball_x_start
        ball_y = ball_y_start
    elif ball_x > WINDOW_WIDTH:
        left_score += 1
        ball_x = ball_x_start
        ball_y = ball_y_start
    # End of solution

    # TODO: Setup scoreboard
    scoreboard_text_surface = scoreboard_font.render(str(left_score), True, SCOREBOARD)
    scoreboard_text_rect = scoreboard_text_surface.get_rect()
    scoreboard_text_rect.center = (WINDOW_WIDTH/8, WINDOW_HEIGHT/8)
    DISPLAY.blit(scoreboard_text_surface, scoreboard_text_rect.center)

    scoreboard_text_surface = scoreboard_font.render(str(right_score), True, SCOREBOARD)
    scoreboard_text_rect = scoreboard_text_surface.get_rect()
    scoreboard_text_rect.center = (WINDOW_WIDTH * 5/8, WINDOW_HEIGHT / 8)
    DISPLAY.blit(scoreboard_text_surface, scoreboard_text_rect.center)
    # End of solution

    # TODO: Draw all objects
    pygame.draw.line(DISPLAY, NET, (WINDOW_WIDTH / 2, 0), (WINDOW_WIDTH / 2, WINDOW_HEIGHT), 6)

    pygame.draw.rect(DISPLAY, PLAYER_ONE, left_paddle_rect)
    pygame.draw.rect(DISPLAY, PLAYER_TWO, right_paddle_rect)
    pygame.draw.circle(DISPLAY, TENNIS_BALL, (ball_x, ball_y), BALL_SIZE)

    # End of solution
    clock.tick(FPS)
    pygame.display.update()
pygame.font.quit()
pygame.quit()
